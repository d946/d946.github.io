{"version":3,"file":"app_worker.js","sources":["../src/app_worker.js"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2024 Volodymyr Shymanskyy\n * SPDX-License-Identifier: MIT\n *\n * The software is provided 'as is', without any warranties or guarantees (explicit or implied).\n * This includes no assurances about being fit for any specific purposevent.\n */\n\nconst cacheName = `viper-${VIPER_IDE_VERSION}`;\n\nconst log = console.log.bind(console).bind(console, `[Service Worker ${VIPER_IDE_VERSION}]`);\n\nconst contentToCache = new Set([\n    '/index.html',\n    '/assets/favicon.png',\n    '/assets/app_1024.png',\n    '/assets/logo_1024.png',\n    '/assets/mpy-cross-v6.wasm',\n    '/assets/micropython.wasm',\n    '/assets/ruff_wasm_bg.wasm',\n    '/assets/tools_vfs.tar.gz',\n    '/assets/vm_vfs.tar.gz',\n]);\n\nself.addEventListener('install', event => {\n  log('Install');\n  event.waitUntil((async () => {\n    const cache = await caches.open(cacheName);\n    await Promise.all(contentToCache.values().map(resource => {\n      return cache.add(new Request(resource, { cache: 'no-store' }));\n    }));\n    self.skipWaiting();\n  })());\n});\n\nself.addEventListener('activate', event => {\n  log('Activate');\n  event.waitUntil((async () => {\n    for (const key of await caches.keys()) {\n      if (key !== cacheName) {\n        log(`Deleting ${key}`);\n        await caches.delete(key);\n      }\n    }\n  })());\n});\n\nfunction normalizeUrl(s) {\n  const url = new URL(s);\n  if (url.pathname === '/') {\n    return new URL('/index.html', url.origin);\n  }\n  return url;\n}\n\nself.addEventListener('fetch', event => {\n  event.respondWith((async () => {\n    const cache = await caches.open(cacheName);\n    const url = normalizeUrl(event.request.url);\n    const r = await cache.match(url);\n    if (r) {\n      log(`Using cached: ${url}`);\n      return r;\n    } else {\n      //log(`Loading: ${url}`);\n      try {\n        const rsp = await fetch(event.request);\n\n        if (contentToCache.has(url.pathname)) {\n          log(`Caching: ${url}`);\n          cache.put(event.request, rsp.clone());\n        }\n\n        return rsp;\n      } catch (err) {\n        log(err.message);\n        throw err;\n      }\n    }\n  })());\n});\n"],"names":[],"mappings":"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"}